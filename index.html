<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="../util/messagingUtil.js"></script>
    <script type="text/javascript" src="../util/contentUtil.js"></script>
    <script type="text/javascript" src="../thirdPartyHelpers/google.js"></script>
    <script type="text/javascript">
<script>
        "use strict";

		va.messagingUtil.setOnDataReceivedCallback(onDataReceived);

		var _resultName = null;
		var _dataTable = null;
		var _selections = null;
		var _sankey = null;
		var _options = {
			chartArea: {
				left: 80,
				bottom: 40,  
				width: '100%',
				height: '100%'  
			},
			legend: {
				position: 'bottom'
			}
		};
		
        google.charts.load('current', {'packages':['sankey']});
		google.charts.setOnLoadCallback(drawChart);
		
		va.contentUtil.setupResizeListener(drawChart);
		
        function onChartLoad() 
		{
            _sankey = new google.visualization.DataTable(document.getElementById('chart_div'));
			google.visualization.events.addListener(_sankey, 'ready', readyHandler);
			google.visualization.events.addListener(_sankey, 'select', selectHandler);
			
			drawChart();
        };
		
		function drawChart()
		{
			if (_sankey)
				_sankey.draw(_dataTable, _options);
		}

        function onDataReceived(resultData)
        {
            if (resultData) 
			{
				_resultName = resultData.resultName;
                va.contentUtil.convertDateColumns(resultData);
                _dataTable = va.googleHelper.createDataTable(resultData);
				va.googleHelper.formatData(_dataTable, resultData);
				va.googleHelper.formatAxis('hAxis', _options, resultData);
				_selections = va.contentUtil.initializeSelections(resultData);
            }

			drawChart();
        }

		function readyHandler(e) 
		{
			if (_selections && _selections.length > 0)
			{
				_sankey.setSelection(_selections);
			}
		}

		function selectHandler(e) 
		{
			var selection = _sankey.getSelection();
			va.messagingUtil.postSelectionMessage(_resultName, selection);
		}

    </script>

        // Sets chart options.
        var options = {
      width: 1500,
	  height: 500,
      sankey: {
		  node: {
			label: {
			  fontName: 'Times-Roman',
			  fontSize: 12,
			  color: '#000',
			  bold: true,
			  italic: true
			},
			interactivity: true, // Allows you to select nodes.
			labelPadding: 2,			// Horizontal distance between the label and the node.
			nodePadding: 25
		  }
		}
	};

        // Instantiates and draws our chart, passing in some options.
        var chart = new google.visualization.Sankey(document.getElementById('sankey_basic'));
        chart.draw(data, options);
      }
    </script>
  </head>
  <body>
    <div id="sankey_basic" style="width: 900px; height: 300px;"></div>
  </body>
</html>